import{r as j,j as e}from"./jsx-runtime-BMrMXMSG.js";import{u as B}from"./useNavigateSubmit-CTqj78J6.js";import{G as p,a as g,b as u,L as I,H as M}from"./constants-xrzLx32Y.js";import{I as E}from"./resourcePicer-CAWIdYIt.js";import{u as D,a as G}from"./index-dL4ND7l9.js";import{b as L,u as O,a as P}from"./components-BDrsBlv3.js";import{S as A}from"./SkeletonPage-oS14FYNy.js";import{B as o,T as n}from"./BlockStack-CBC_PXe6.js";import{B as F}from"./Banner-DrpU63xa.js";import{F as N}from"./index-y3bcNOgC.js";import{L as l}from"./Layout-CMntMX4Q.js";import{C as S}from"./Card-DdP2um4p.js";import{I as k,T as c}from"./TextField-B-Nm0VLF.js";import{I as H}from"./InlineGrid-Df5BtU4c.js";import{B as m}from"./Box-CnqJGKrn.js";import{C as $}from"./ChoiceList-Dt5iyaoi.js";import{B as z}from"./ButtonGroup-GOmEL2FH.js";import{B as b}from"./use-toggle-Bx-o2WPs.js";import"./index-BdEiwQAR.js";import"./InlineStack-BYbsxF_T.js";import"./context-C-JwoyEZ.js";import"./within-content-context-B9v2rWOt.js";import"./use-event-listener-DOg0fKDs.js";import"./Icon-C-cZWGQM.js";import"./use-is-after-initial-mount-DPsAqfZs.js";import"./EventListener-kZJ1rsuP.js";import"./Bleed-DpULRbVU.js";function xe(){const h=D().state!="idle",v=B(),w=L(),f=G(),x=O(),y=x?.data,s=x?.errors,C={...P().data,stepType:P().data.stepType},[i,d]=j.useState(s?.length===0||!s?C:y),T=t=>{d(r=>r.productInput?{...r,productInput:{...r.productInput,products:t}}:r),a("products")};j.useEffect(()=>{if(s&&s.length===0){window.scrollTo(0,0);return}s?.forEach(t=>{if(t.fieldId){document.getElementById(t.fieldId)?.scrollIntoView();return}})},[h,s]);const a=t=>{s?.forEach(r=>{r.fieldId===t&&(r.message="")})};return e.jsx(e.Fragment,{children:h||w.state!=="idle"?e.jsx(A,{primaryAction:!0,fullWidth:!0}):e.jsxs(o,{gap:p,children:[s&&s.length===0?e.jsx(F,{title:"Step updated!",tone:"success",onDismiss:()=>{},children:e.jsx(o,{gap:g,children:e.jsx(n,{as:"p",variant:"headingMd",children:"You succesfuly updated this step."})})}):null,e.jsxs(N,{method:"POST","data-discard-confirmation":!0,"data-save-bar":!0,children:[e.jsx("input",{type:"hidden",name:"action",defaultValue:"updateStep"}),e.jsx("input",{type:"hidden",name:"stepData",value:JSON.stringify(i)}),e.jsxs(o,{gap:u,children:[e.jsxs(l,{children:[e.jsx(l.Section,{children:e.jsx(S,{children:e.jsxs(o,{gap:I,children:[e.jsxs(o,{gap:p,children:[e.jsx(n,{as:"h2",variant:"headingLg",children:"Product step configuration"}),e.jsx(n,{as:"p",variant:"bodyMd",tone:"subdued",children:"On product steps, customers can choose products to add to their bundle."})]}),e.jsxs(o,{gap:u,children:[e.jsx(n,{as:"h2",variant:"headingMd",children:"Available products for customers to select"}),e.jsxs(o,{gap:p,children:[e.jsx("input",{name:"products[]",type:"hidden",value:i.productInput?.products.map(t=>t.shopifyProductId).join(",")}),e.jsx(E,{stepId:i.id,selectedProducts:i.productInput?.products||[],updateSelectedProducts:T}),e.jsx(n,{as:"p",variant:"bodyMd",tone:"subdued",children:"This will be the list of products that customers can choose from."}),e.jsx(k,{message:s?.find(t=>t.fieldId==="products")?.message||"",fieldID:"products"})]})]}),e.jsxs(o,{gap:u,children:[e.jsx(n,{as:"h2",variant:"headingMd",children:"Product rules"}),e.jsxs(o,{gap:I,children:[e.jsxs(H,{columns:2,gap:M,children:[e.jsx(m,{id:"minProducts",children:e.jsx(c,{label:"Minimum products to select",type:"number",helpText:"Customers must select at least this number of products on this step.",autoComplete:"off",inputMode:"numeric",name:"minProductsToSelect",min:1,value:i.productInput?.minProductsOnStep.toString(),onChange:t=>{d(r=>r.productInput?{...r,productInput:{...r.productInput,minProductsOnStep:Number(t)}}:{...r}),a("minProducts")},error:s?.find(t=>t.fieldId==="minProducts")?.message})}),e.jsx(m,{id:"maxProducts",children:e.jsx(c,{label:"Maximum products to select",helpText:"Customers can select up to this number of products on this step.",type:"number",autoComplete:"off",inputMode:"numeric",name:"maxProductsToSelect",min:i.productInput?.minProductsOnStep||1,value:i.productInput?.maxProductsOnStep.toString(),onChange:t=>{d(r=>r.productInput?{...r,productInput:{...r.productInput,maxProductsOnStep:Number(t)}}:r),a("maxProducts")},error:s?.find(t=>t.fieldId==="maxProducts")?.message})})]}),e.jsx($,{title:"Display products",allowMultiple:!0,name:"displayProducts",choices:[{label:"Allow customers to select one product more than once",value:"allowProductDuplicates"},{label:"Show the price under each product",value:"showProductPrice"}],selected:[i.productInput?.allowProductDuplicates?"allowProductDuplicates":"",i.productInput?.showProductPrice?"showProductPrice":""],onChange:t=>{d(r=>r.productInput?{...r,productInput:{...r.productInput,allowProductDuplicates:t.includes("allowProductDuplicates"),showProductPrice:t.includes("showProductPrice")}}:r)}})]})]})]})})}),e.jsx(l.Section,{variant:"oneThird",children:e.jsx(o,{gap:u,children:e.jsx(S,{children:e.jsxs(o,{gap:g,children:[e.jsx(n,{as:"h2",variant:"headingMd",children:"Step details"}),e.jsx(c,{label:"Step title",error:s?.find(t=>t.fieldId==="stepTitle")?.message,type:"text",name:"stepTitle",value:i.title,helpText:"Customers will see this title when they build a bundle.",onChange:t=>{d(r=>({...r,title:t})),a("stepTitle")},autoComplete:"off"}),e.jsx(c,{label:"Step description",value:i.description,type:"text",name:"stepDescription",helpText:"Customers will see this description on this step.",onChange:t=>{d(r=>({...r,description:t})),a("stepDESC")},error:s?.find(t=>t.fieldId==="stepDESC")?.message,autoComplete:"off"})]})})})})]}),e.jsx(m,{width:"full",children:e.jsx(o,{inlineAlign:"end",children:e.jsxs(z,{children:[e.jsx(b,{variant:"primary",tone:"critical",onClick:async()=>{await shopify.saveBar.leaveConfirmation(),v("deleteStep",`/app/edit-bundle-builder/${f.bundleid}/steps/${f.stepnum}?redirect=true`)},children:"Delete"}),e.jsx(b,{variant:"primary",submit:!0,children:"Save step"})]})})})]})]})]})})}export{xe as default};
