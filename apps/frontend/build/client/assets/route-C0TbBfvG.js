import{R as x,r as T,j as e}from"./jsx-runtime-BMrMXMSG.js";import{R as K,p as $,_ as M}from"./index-BdEiwQAR.js";import{b as v,G as P,a as _}from"./constants-xrzLx32Y.js";import{B as R}from"./BundleDiscountTypeClient-B-3njYHa.js";import{u as de}from"./useNavigateSubmit-CTqj78J6.js";import{b as ee,u as te,a as ne,e as ce,i as ue}from"./index-dL4ND7l9.js";import{b as pe,L as F,u as he,a as me}from"./components-BDrsBlv3.js";import{u as xe,F as be}from"./index-y3bcNOgC.js";import{S as ie}from"./SkeletonPage-oS14FYNy.js";import{B as i,T as l}from"./BlockStack-CBC_PXe6.js";import{C as s}from"./Card-DdP2um4p.js";import{S as u}from"./SkeletonBodyText-PJLcqbGt.js";import{B as m}from"./Box-CnqJGKrn.js";import{T as I}from"./TextField-B-Nm0VLF.js";import{D as ae}from"./Divider-BzciHtgk.js";import{B as U}from"./ButtonGroup-GOmEL2FH.js";import{B as g,a as je}from"./use-toggle-Bx-o2WPs.js";import{I as W}from"./InlineStack-BYbsxF_T.js";import{S as Z,D as ge,E as fe,a as ve}from"./EmptyState-Bdvqmiml.js";import{B as L}from"./Badge-PSuHbHll.js";import{S as ye}from"./DeleteIcon.svg-BsxW9olQ.js";import{S as Ce}from"./EditIcon.svg-SYyjgaKg.js";import{P as Te}from"./Page-C2Lx7T4Z.js";import{S as Se}from"./ExternalIcon.svg-1Nno8FFk.js";import{B as we}from"./Banner-DrpU63xa.js";import{L as z}from"./Layout-CMntMX4Q.js";import{C as Be}from"./ChoiceList-Dt5iyaoi.js";import{T as X}from"./Pagination-B_BjUQTQ.js";import{I as Y}from"./Icon-C-cZWGQM.js";import{S as J}from"./QuestionCircleIcon.svg-CfqkKV47.js";import{S as q}from"./Select-Cif7Qcy3.js";import{F as Pe}from"./FooterHelp-BUGPZSpp.js";import"./context-C-JwoyEZ.js";import"./within-content-context-B9v2rWOt.js";import"./use-is-after-initial-mount-DPsAqfZs.js";import"./use-event-listener-DOg0fKDs.js";import"./EventListener-kZJ1rsuP.js";import"./context-g-r66Qxo.js";import"./Bleed-DpULRbVU.js";import"./context-B2IVp4WU.js";var se=function(o){return x.createElement("svg",Object.assign({viewBox:"0 0 20 20"},o),x.createElement("path",{fillRule:"evenodd",d:"M10 3.5a.75.75 0 0 1 .75.75v9.69l2.72-2.72a.75.75 0 0 1 1.06 1.06l-4 4a.75.75 0 0 1-1.06 0l-4-4a.75.75 0 0 1 1.06-1.06l2.72 2.72v-9.69a.75.75 0 0 1 .75-.75Z"}))};se.displayName="ArrowDownIcon";var re=function(o){return x.createElement("svg",Object.assign({viewBox:"0 0 20 20"},o),x.createElement("path",{fillRule:"evenodd",d:"M10 16.5a.75.75 0 0 1-.75-.75v-9.69l-2.72 2.72a.75.75 0 1 1-1.06-1.06l4-4a.75.75 0 0 1 1.06 0l4 4a.75.75 0 1 1-1.06 1.06l-2.72-2.72v9.69a.75.75 0 0 1-.75.75Z"}))};re.displayName="ArrowUpIcon";var le=function(o){return x.createElement("svg",Object.assign({viewBox:"0 0 20 20"},o),x.createElement("path",{fillRule:"evenodd",d:"M5.5 5.75c0-.69.56-1.25 1.25-1.25h2.75v3.25c0 .966.784 1.75 1.75 1.75h3.25v1.25a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-.22-.53l-5-5a.75.75 0 0 0-.53-.22h-3.5a2.75 2.75 0 0 0-2.75 2.75v8.5a2.75 2.75 0 0 0 2.75 2.75h4.25a.75.75 0 0 0 0-1.5h-4.25c-.69 0-1.25-.56-1.25-1.25v-8.5Zm7.94 2.25-2.44-2.44v2.19c0 .138.112.25.25.25h2.19Z"}),x.createElement("path",{d:"M14.5 13.25a.75.75 0 0 1 1.5 0v1.25h1.25a.75.75 0 0 1 0 1.5h-1.25v1.25a.75.75 0 0 1-1.5 0v-1.25h-1.25a.75.75 0 0 1 0-1.5h1.25v-1.25Z"}))};le.displayName="PageAddIcon";var oe=function(o){return x.createElement("svg",Object.assign({viewBox:"0 0 20 20"},o),x.createElement("path",{d:"M3.5 9.25a.75.75 0 0 0 1.5 0 3 3 0 0 1 3-3h6.566l-1.123 1.248a.75.75 0 1 0 1.114 1.004l2.25-2.5a.75.75 0 0 0-.027-1.032l-2.25-2.25a.75.75 0 1 0-1.06 1.06l.97.97h-6.44a4.5 4.5 0 0 0-4.5 4.5Z"}),x.createElement("path",{d:"M16.5 10.75a.75.75 0 0 0-1.5 0 3 3 0 0 1-3 3h-6.566l1.123-1.248a.75.75 0 1 0-1.114-1.004l-2.25 2.5a.75.75 0 0 0 .027 1.032l2.25 2.25a.75.75 0 0 0 1.06-1.06l-.97-.97h6.44a4.5 4.5 0 0 0 4.5-4.5Z"}))};oe.displayName="RefreshIcon";var G=(a=>(a.FIXED="FIXED",a.CALCULATED="CALCULATED",a))(G||{});const De="_sticky_hjc71_1",Ie="_tableWrapper_hjc71_1",Ee="_loadingTable_hjc71_13",Ae="_hide_hjc71_26",Ne="_dummyIconPlaceholder_hjc71_30",ke="_tooltipContent_hjc71_37",Oe="_stepTitleContainer_hjc71_43",D={sticky:De,tableWrapper:Ie,loadingTable:Ee,hide:Ae,dummyIconPlaceholder:Ne,tooltipContent:ke,stepTitleContainer:Oe};function _e({user:a,bundleBuilderSteps:o}){const S=ee(),E=te(),b=K(),y=E.state!="idle",h=ne(),f=pe(),C=xe(),r=o.sort((t,d)=>t.stepNumber-d.stepNumber),A=()=>o.length>=5?(b.modal.show("no-more-steps-modal"),!1):a.isDevelopmentStore?!0:a.activeBillingPlan==="BASIC"&&o.length>=2?(b.modal.show("step-limit-modal"),!1):!0,[p,N]=T.useState(),[c,j]=T.useState("PRODUCT"),k=async()=>{A()&&b.modal.show("new-step-modal")},w=()=>{if(!p)return;const t=new FormData;if(c==="PRODUCT"){const d={title:p,description:"",stepNumber:o.length+1,stepType:"PRODUCT",productInput:{minProducts:0,maxProducts:0}};t.append("stepData",JSON.stringify(d)),t.append("action","addProductStep")}else{const d={title:p,description:"",stepNumber:o.length+1,stepType:"CONTENT"};t.append("stepData",JSON.stringify(d)),t.append("action","addContentStep")}C(t,{method:"POST",action:`/app/edit-bundle-builder/${h.bundleid}/steps`}),b.modal.hide("new-step-modal")},V=async t=>{if(!A())return;const d=new FormData;d.append("action","duplicateStep"),f.submit(d,{method:"POST",action:`/app/edit-bundle-builder/${h.bundleid}/steps/${t}`})},B=async t=>{const d=new FormData;d.append("action","deleteStep"),f.submit(d,{method:"POST",action:`/app/edit-bundle-builder/${h.bundleid}/steps/${t}`})},O=async(t,d)=>{const H=new FormData;H.append("action",d),H.append("stepId",t.toString()),f.submit(H,{method:"POST",action:`/app/edit-bundle-builder/${h.bundleid}/steps`})},n=async t=>{await b.saveBar.leaveConfirmation(),S(t)};return T.useEffect(()=>{},[f.state]),e.jsx(e.Fragment,{children:y?e.jsx(ie,{primaryAction:!0,children:e.jsxs(i,{gap:"500",children:[e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs($,{id:"step-limit-modal",children:[e.jsx(m,{padding:"300",children:e.jsxs(i,{gap:v,children:[e.jsx(l,{as:"p",children:"You are on the 'Basic' plan which only allows you to create up to 2 steps for each bundle."}),e.jsxs(l,{as:"p",variant:"headingSm",children:["If you want to create more steps, go to ",e.jsx(F,{to:"/app/billing",children:"billing"})," and upgrade to paid plan."]})]})}),e.jsx(M,{title:"Maximum steps reached",children:e.jsx("button",{variant:"primary",type:"button",onClick:()=>b.modal.hide("step-limit-modal"),children:"Close"})})]}),e.jsxs($,{id:"no-more-steps-modal",children:[e.jsx(m,{padding:"300",children:e.jsx(l,{as:"p",children:"You can't add more than 5 steps for one bundle."})}),e.jsx(M,{title:"Maximum steps reached",children:e.jsx("button",{variant:"primary",type:"button",onClick:()=>b.modal.hide("no-more-steps-modal"),children:"Close"})})]}),e.jsxs($,{id:"new-step-modal",children:[e.jsx(m,{padding:"300",children:e.jsxs(i,{gap:v,children:[e.jsxs(i,{gap:v,children:[e.jsx(l,{as:"p",variant:"headingSm",children:"Enter the title of your new step"}),e.jsx(I,{label:"Title",labelHidden:!0,autoComplete:"off",inputMode:"text",name:"bundleTitle",helpText:"Customers will see this title when they build a bundle.",value:p,error:p===""?"Please enter a title":void 0,onChange:t=>{N(t)},type:"text"})]}),e.jsx(ae,{}),e.jsxs(i,{gap:v,align:"center",inlineAlign:"center",children:[e.jsx(l,{as:"p",variant:"headingSm",children:"Select the type of step you want to create."}),e.jsxs(U,{variant:"segmented",children:[e.jsx(g,{pressed:c==="PRODUCT",size:"large",onClick:()=>j("PRODUCT"),children:"Product step"}),e.jsx(g,{pressed:c==="CONTENT",size:"large",onClick:()=>j("CONTENT"),children:"Content step"})]}),e.jsx(l,{as:"p",variant:"bodyMd",children:c==="PRODUCT"?"Customers will be able to select products on this step.":"Customers will be able to enter content (text, image, etc) on this step."})]})]})}),e.jsx(M,{title:"New step",children:e.jsx("button",{variant:"primary",type:"button",onClick:w,disabled:y,children:"Create"})})]}),e.jsxs("div",{id:D.tableWrapper,children:[e.jsx("div",{className:f.state!=="idle"?D.loadingTable:D.hide,children:e.jsx(je,{accessibilityLabel:"Spinner example",size:"large"})}),e.jsx(s,{children:e.jsxs(i,{children:[e.jsxs(W,{align:"space-between",children:[e.jsx(l,{as:"h2",variant:"headingMd",children:"Bundle steps"}),e.jsx(g,{icon:Z,size:"slim",variant:"primary",onClick:k,children:"Add step"})]}),r.length>0?e.jsx(ge,{hoverable:!0,columnContentTypes:["text","text","text","text","text"],headings:["Step","Title","Type","Rearange","Actions"],rows:r.map(t=>[t.stepNumber,e.jsx(F,{onClick:n.bind(null,`/app/edit-bundle-builder/${h.bundleid}/steps/${t.stepNumber}/${t.stepType==="PRODUCT"?"product":"content"}`),to:"#",children:e.jsx("div",{className:D.stepTitleContainer,children:e.jsx(l,{as:"p",tone:"base",children:t.title})})}),t.stepType==="PRODUCT"?e.jsx(L,{tone:"warning",children:"Product step"}):e.jsx(L,{tone:"magic",children:"Content step"}),e.jsx(U,{children:e.jsxs(W,{align:"space-between",blockAlign:"stretch",children:[t.stepNumber!==r.length?e.jsx(g,{icon:se,size:"slim",variant:"plain",onClick:O.bind(null,t.id,"moveStepDown")}):e.jsx("div",{className:D.dummyIconPlaceholder,children:" "}),t.stepNumber!==1&&e.jsx(g,{icon:re,size:"slim",variant:"plain",onClick:O.bind(null,t.id,"moveStepUp")})]})}),e.jsxs(U,{children:[e.jsx(g,{icon:ye,variant:"secondary",tone:"critical",onClick:B.bind(null,t.stepNumber)}),e.jsx(g,{icon:le,variant:"secondary",onClick:()=>{V(t.stepNumber)},children:"Duplicate"}),e.jsx(g,{icon:Ce,variant:"primary",onClick:n.bind(null,`/app/edit-bundle-builder/${h.bundleid}/steps/${t.stepNumber}/${t.stepType==="PRODUCT"?"product":"content"}`),children:"Edit"})]})])}):e.jsx(fe,{heading:"Letâ€™s create the first step for your customers to take!",action:{content:"Create step",icon:Z,onAction:k},fullWidth:!0,image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Your customers will be able to select products or add content (like text or images) at each step to their bundle."})})]})})]})]})})}const Re="_tooltipContent_i3ne1_1",$e="_stepTitleContainer_i3ne1_7",Q={tooltipContent:Re,stepTitleContainer:$e};function St(){const a=te(),o=ee(),S=K(),E=a.state==="loading",b=a.state==="submitting",y=ne(),h=de(),f=he(),C=me().data,r=f?.errors;console.log(r);const A=f?.data,p=C.bundleBuilder,N=C.bundleBuilderPageUrl,[c,j]=T.useState(r?.length===0||!r?p:A),[k,w]=T.useState(!1),V=async()=>{await S.saveBar.leaveConfirmation(),w(!0),h("deleteBundle",`/app/edit-bundle-builder/${y.bundleid}/builder?redirect=true`)};T.useEffect(()=>{if(r&&r.length===0){window.scrollTo(0,0);return}r?.forEach(n=>{if(n.fieldId){document.getElementById(n.fieldId)?.scrollIntoView();return}})},[E,r]);const B=n=>{r?.forEach(t=>{t.fieldId===n&&(t.message="")})},O=async()=>{await S.saveBar.leaveConfirmation(),h("recreateBundleBuilder",`/app/edit-bundle-builder/${y.bundleid}/builder`)};return e.jsx(e.Fragment,{children:E||b?e.jsx(ie,{primaryAction:!0,children:e.jsxs(i,{gap:"500",children:[e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})}),e.jsx(s,{children:e.jsx(u,{})})]})}):e.jsxs("div",{children:[e.jsxs($,{id:"delete-confirm-modal",open:k,children:[e.jsx(m,{padding:"300",children:e.jsx(l,{as:"p",children:"If you delete this bundle, everything will be lost forever."})}),e.jsxs(M,{title:"Are you sure you want to delete this bundle?",children:[e.jsx("button",{onClick:()=>w(!1),children:"Close"}),e.jsx("button",{variant:"primary",tone:"critical",onClick:()=>{h("deleteBundle",`/app/edit-bundle-builder/${y.bundleid}/builder?redirect=true`),w(!1)},children:"Delete"})]})]}),e.jsx(Te,{secondaryActions:[{content:"Settings",url:`/app/edit-bundle-builder/${p.id}/settings/?redirect=/app/edit-bundle-builder/${p.id}/builder`,icon:ve},{content:"See bundle page",accessibilityLabel:"Preview action label",icon:Se,url:`${N}`,target:"_blank"},{icon:oe,onAction:O,content:"Recreate bundle",helpText:"If you accidentally deleted the page where this bundle is displayed or you deleted the dummy product associated with this bundle, click this button to recreate both of them."}],titleMetadata:p.published?e.jsx(L,{tone:"success",children:"Active"}):e.jsx(L,{tone:"info",children:"Draft"}),backAction:{content:"Products",onAction:async()=>{await S.saveBar.leaveConfirmation(),o("/app")}},title:`${p.title}`,subtitle:"Edit bundle details and steps",compactTitle:!0,children:e.jsxs(i,{gap:P,children:[r&&r.length===0?e.jsx(we,{title:"Bundle updated!",tone:"success",onDismiss:()=>{},children:e.jsx(i,{gap:_,children:e.jsx(l,{as:"p",variant:"headingMd",children:"You succesfuly updated this bundle."})})}):null,e.jsx(be,{method:"POST","data-discard-confirmation":!0,"data-save-bar":!0,children:e.jsxs(i,{gap:v,children:[e.jsxs(z,{children:[e.jsx(z.Section,{children:e.jsxs(i,{gap:v,children:[e.jsx(_e,{user:C.user,bundleBuilderSteps:C.allBundleSteps}),e.jsx(s,{children:e.jsxs(i,{gap:P,children:[e.jsx(l,{as:"p",variant:"headingMd",children:"Bundle page"}),e.jsx(i,{gap:_,children:e.jsx(I,{label:"Bundle page",labelHidden:!0,autoComplete:"off",readOnly:!0,name:"bundlePage",helpText:"Send customers to this page to let them create their unique bundles.",value:N,type:"url"})})]})}),e.jsx(s,{children:e.jsxs(i,{children:[e.jsx(l,{as:"p",variant:"headingMd",children:"Bundle Pricing"}),e.jsx(Be,{title:"Bundle Pricing",name:"bundlePricing",titleHidden:!0,choices:[{label:"Calculated price ",value:G.CALCULATED,helpText:e.jsx(X,{width:"wide",activatorWrapper:"div",content:`e.g. use case: you want to sell a shirt,
                                      pants, and a hat in a bundle with a 10%
                                      discount on the whole order, and you want the
                                      total price before discount to be the sum of
                                      the prices of individual products that the customer has selected.`,children:e.jsxs("div",{className:Q.tooltipContent,children:[e.jsx(m,{children:e.jsx("p",{children:"The final price will be the sum of the prices of all products that the customer has selected."})}),e.jsx(m,{children:e.jsx(Y,{source:J})})]})})},{label:"Fixed price",value:G.FIXED,helpText:e.jsx(X,{width:"wide",activatorWrapper:"div",content:`e.g. use case: you want to sell 5 cookies
                                    in a bundle, always at the same price, but want
                                    your customers to be able to select which
                                    cookies they want.`,children:e.jsxs("div",{className:Q.tooltipContent,children:[e.jsx(m,{children:e.jsx(l,{as:"p",children:"All bundles created will be priced the same."})}),e.jsx(m,{children:e.jsx(Y,{source:J})})]})}),renderChildren:n=>n?e.jsx(m,{maxWidth:"50",id:"priceAmount",children:e.jsx(I,{label:"Price",type:"number",name:"priceAmount",inputMode:"numeric",autoComplete:"off",min:0,error:r?.find(t=>t.fieldId==="priceAmount")?.message,value:c.priceAmount?.toString(),prefix:"$",onChange:t=>{j(d=>({...d,priceAmount:parseFloat(t)})),B("priceAmount")}})}):null}],selected:[c.pricing],onChange:n=>{j(t=>({...t,pricing:n[0]}))}})]})}),e.jsx(s,{children:e.jsxs(i,{gap:P,children:[e.jsx(l,{as:"p",variant:"headingMd",children:"Bundle Discount"}),e.jsxs(i,{gap:_,children:[e.jsx(q,{label:"Discount Type",name:"bundleDiscountType",options:[{label:"Percentage (e.g. 25% off)",value:R.PERCENTAGE},{label:"Fixed (e.g. 10$ off)",value:R.FIXED},{label:"No discount",value:R.NO_DISCOUNT}],value:c.discountType,onChange:n=>{j(t=>({...t,discountType:n}))}}),e.jsx(I,{label:"Discount amount",type:"number",autoComplete:"off",inputMode:"numeric",disabled:c.discountType==="NO_DISCOUNT",name:"discountValue",prefix:c.discountType===R.PERCENTAGE?"%":"$",min:0,max:100,value:c.discountValue.toString(),error:r?.find(n=>n.fieldId==="discountValue")?.message,onChange:n=>{j(t=>({...t,discountValue:parseInt(n)})),B("discountValue")}})]})]})})]})}),e.jsx(z.Section,{variant:"oneThird",children:e.jsxs(i,{gap:v,children:[e.jsx("input",{type:"hidden",name:"action",defaultValue:"updateBundle"}),e.jsx("input",{type:"hidden",name:"bundle",defaultValue:JSON.stringify(c)}),e.jsxs(i,{gap:v,children:[e.jsx(s,{children:e.jsxs(i,{gap:P,children:[e.jsx(l,{as:"p",variant:"headingMd",children:"Bundle title"}),e.jsx(i,{gap:_,children:e.jsx(I,{label:"Title",labelHidden:!0,autoComplete:"off",inputMode:"text",name:"bundleTitle",helpText:"This title will be displayed to your customers on the bundle page, in checkout, and in the cart.",error:r?.find(n=>n.fieldId==="bundleTitle")?.message,value:c.title,onChange:n=>{j(t=>({...t,title:n})),B("bundleTitle")},type:"text"})})]})}),e.jsx(s,{children:e.jsxs(i,{gap:P,children:[e.jsx(l,{as:"p",variant:"headingMd",children:"Bundle status"}),e.jsx(q,{label:"Visibility",name:"bundleVisibility",labelHidden:!0,options:[{label:"Active",value:"true"},{label:"Draft",value:"false"}],helpText:"Bundles set to 'ACTIVE' are visible to anyone browsing your store.",value:c.published?"true":"false",onChange:n=>{j(t=>({...t,published:n==="true"}))}})]})})]})]})})]}),e.jsx(ae,{borderColor:"transparent"}),e.jsx(m,{width:"full",children:e.jsx(i,{inlineAlign:"end",children:e.jsxs(U,{children:[e.jsx(g,{variant:"primary",tone:"critical",onClick:V,children:"Delete"}),e.jsx("button",{className:"Polaris-Button Polaris-Button--pressable Polaris-Button--variantSecondary Polaris-Button--sizeMedium Polaris-Button--textAlignCenter",name:"submitBtn",value:"saveBtn",type:"submit",children:e.jsx("span",{className:"Polaris-Text--root Polaris-Text--bodySm Polaris-Text--medium",children:"Save"})}),e.jsx("button",{className:"Polaris-Button Polaris-Button--pressable Polaris-Button--variantPrimary Polaris-Button--sizeMedium Polaris-Button--textAlignCenter",name:"submitBtn",value:"saveAndExitBtn",type:"submit",children:e.jsx("span",{className:"Polaris-Text--root Polaris-Text--bodySm Polaris-Text--medium",children:"Save and return"})})]})})}),e.jsxs(Pe,{children:["Are you stuck? ",e.jsx(F,{to:"/app/help",children:"Get help"})," from us, or ",e.jsx(F,{to:"/app/feature-request",children:"suggest new features"}),"."]})]})})]})})]})})}function wt(){const a=ce();return ue(a)?e.jsxs("div",{children:[e.jsxs("h1",{children:[a.status," ",a.statusText]}),e.jsx("p",{children:a.data})]}):a instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:"Error"}),e.jsx("p",{children:a.message}),e.jsx("p",{children:"The stack trace is:"}),e.jsx("pre",{children:a.stack})]}):e.jsx("h1",{children:"Unknown Error"})}export{wt as ErrorBoundary,St as default};
