{"version":3,"sources":["../../src/bundle-builders/bundle-builder.repository.ts"],"sourcesContent":["import db from \"@db/server\";\nimport { Injectable } from \"@nestjs/common\";\nimport { CreateBundleBuilderDto } from \"./dto/create-bundle-builder.dto\";\nimport { UpdateBundleBuilderDto } from \"./dto/update-bundle-builder.dto\";\nimport { BundleBuilderAndStepsBasicDto } from \"./dto/bundle-builder-basic.dto\";\nimport { BundleBuilderEntity } from \"./entities/bundle-builder.entity\";\n\n@Injectable()\nexport class BundleBuilderRepository {\n    public async create(createBundleBuilderDto: CreateBundleBuilderDto): Promise<BundleBuilderEntity> {\n        const bundleBuilder: BundleBuilderEntity = await db.bundleBuilder.create({\n            data: {\n                shop: createBundleBuilderDto.shop,\n                title: createBundleBuilderDto.title,\n                published: true,\n                shopifyProductId: createBundleBuilderDto.title,\n                bundleBuilderConfig: {\n                    create: {\n                        skipTheCart: false,\n                        allowBackNavigation: true,\n                        showOutOfStockProducts: false,\n                    },\n                },\n            },\n        });\n\n        return bundleBuilder;\n    }\n\n    public async delete(id: number): Promise<BundleBuilderEntity | null> {\n        return await db.bundleBuilder.update({\n            where: {\n                id: id,\n            },\n            data: {},\n        });\n    }\n\n    public async get(id: number, shop: string): Promise<BundleBuilderEntity | null> {\n        return db.bundleBuilder.findUnique({\n            where: {\n                id: id,\n                shop: shop,\n            },\n        });\n    }\n\n    async getWithSteps(id: number, shop: string): Promise<BundleBuilderAndStepsBasicDto | null> {\n        return await db.bundleBuilder.findUnique({\n            where: {\n                id: id,\n            },\n            include: {\n                bundleBuilderSteps: true,\n            },\n        });\n    }\n\n    public async getAll(shop: string): Promise<BundleBuilderEntity[]> {\n        return await db.bundleBuilder.findMany({\n            where: {\n                shop: shop,\n            },\n        });\n    }\n\n    public async update(updateBundleBuilderDto: UpdateBundleBuilderDto): Promise<BundleBuilderEntity> {\n        return await db.bundleBuilder.update({\n            where: {\n                id: updateBundleBuilderDto.id,\n            },\n            data: updateBundleBuilderDto,\n        });\n    }\n\n    public async getCount(shop: string): Promise<number> {\n        return db.bundleBuilder.count({\n            where: {\n                shop: shop,\n            },\n        });\n    }\n}\n"],"names":["BundleBuilderRepository","create","createBundleBuilderDto","bundleBuilder","db","data","shop","title","published","shopifyProductId","bundleBuilderConfig","skipTheCart","allowBackNavigation","showOutOfStockProducts","delete","id","update","where","get","findUnique","getWithSteps","include","bundleBuilderSteps","getAll","findMany","updateBundleBuilderDto","getCount","count"],"mappings":";;;;+BAQaA;;;eAAAA;;;+DARE;wBACY;;;;;;;;;;;;AAOpB,IAAA,AAAMA,0BAAN,MAAMA;IACT,MAAaC,OAAOC,sBAA8C,EAAgC;QAC9F,MAAMC,gBAAqC,MAAMC,eAAE,CAACD,aAAa,CAACF,MAAM,CAAC;YACrEI,MAAM;gBACFC,MAAMJ,uBAAuBI,IAAI;gBACjCC,OAAOL,uBAAuBK,KAAK;gBACnCC,WAAW;gBACXC,kBAAkBP,uBAAuBK,KAAK;gBAC9CG,qBAAqB;oBACjBT,QAAQ;wBACJU,aAAa;wBACbC,qBAAqB;wBACrBC,wBAAwB;oBAC5B;gBACJ;YACJ;QACJ;QAEA,OAAOV;IACX;IAEA,MAAaW,OAAOC,EAAU,EAAuC;QACjE,OAAO,MAAMX,eAAE,CAACD,aAAa,CAACa,MAAM,CAAC;YACjCC,OAAO;gBACHF,IAAIA;YACR;YACAV,MAAM,CAAC;QACX;IACJ;IAEA,MAAaa,IAAIH,EAAU,EAAET,IAAY,EAAuC;QAC5E,OAAOF,eAAE,CAACD,aAAa,CAACgB,UAAU,CAAC;YAC/BF,OAAO;gBACHF,IAAIA;gBACJT,MAAMA;YACV;QACJ;IACJ;IAEA,MAAMc,aAAaL,EAAU,EAAET,IAAY,EAAiD;QACxF,OAAO,MAAMF,eAAE,CAACD,aAAa,CAACgB,UAAU,CAAC;YACrCF,OAAO;gBACHF,IAAIA;YACR;YACAM,SAAS;gBACLC,oBAAoB;YACxB;QACJ;IACJ;IAEA,MAAaC,OAAOjB,IAAY,EAAkC;QAC9D,OAAO,MAAMF,eAAE,CAACD,aAAa,CAACqB,QAAQ,CAAC;YACnCP,OAAO;gBACHX,MAAMA;YACV;QACJ;IACJ;IAEA,MAAaU,OAAOS,sBAA8C,EAAgC;QAC9F,OAAO,MAAMrB,eAAE,CAACD,aAAa,CAACa,MAAM,CAAC;YACjCC,OAAO;gBACHF,IAAIU,uBAAuBV,EAAE;YACjC;YACAV,MAAMoB;QACV;IACJ;IAEA,MAAaC,SAASpB,IAAY,EAAmB;QACjD,OAAOF,eAAE,CAACD,aAAa,CAACwB,KAAK,CAAC;YAC1BV,OAAO;gBACHX,MAAMA;YACV;QACJ;IACJ;AACJ"}